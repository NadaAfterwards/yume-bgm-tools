# Info
A set of tools aimed at aiding with the process of contributing BGMs files to [Yume Wiki](https://yume.wiki/Main_Page), a MediaWiki dedicated to documenting Yume Nikki fangames.
These tools are designed with the intention of automating all aspects involved when making this sort of contribution. From obtaining the information necessary which usually requires either playing the game or importing it in RPG Maker 2000/2003, to modifying the game files to meet the Wiki's [styleguide](https://yume.wiki/YumeWiki:Style_Guide#Audio) and finally uploading these game files and editing the corresponding articles. With these tools the entire process should be streamlined to make it less tedious and time consuming.

# The Tools
Each tool tackles one aspect of the entire process, this segmentation eases the creation of the tools as well as giving the flexibility to the user on picking what aspect they wish to work on.
As of right now, only BGM File Adapter is publicly available.

**BGM Data Extractor:** A tool designed to obtain all the necessary information by reading through the `RPG_RT.ldb` file contained in each RPG Maker game, powered by [EasyRPG's](https://easyrpg.org/tools/) Tool "LCF2XML". BGM Data Extractor runs LCF2XML for you and then parses its output to extract the necessary information into a CSV file, this information being: The name of the game, the name of the audio file, the tempo (or speed) in which it plays, the map ID where it plays in-game.

**BGM File Adapter:** This tool handles the modification of the audio files while keeping them in-line to the Yume Wiki styleguide, powered by the [ffmpeg](https://ffmpeg.org/) library. Users can select between two methods of file handling, a "one-by-one" mode intended for processing a couple of files or a "batch" mode intended to process several hundred files using the outputted CSV from the previous tool. This tool eliminates the need to manually manipulate each file in programs such as Audacity.

**BGM Wiki Bot (name pending):** With this tool you can take the outputted audio files from the previous tool and alongside the CSV from the first one, upload these files to Yume Wiki and apply them to their respectice location pages. This tool is powered by the [MediaWiki API](https://www.mediawiki.org/wiki/API:Main_page) and as such is heavily dependent in authentication and rights to use bots pertaining to Yume Wiki.

All tools are made using Python 3.11 or above, retroactive support is expected to go as far as Python 3.6 (when f-strings were added) but there are no guarantees. The tools are also expected to be compatible with Windows and Linux systems.

# Usage
This section will only describe BGM File Adapter usage at this time.
## BGM File Adapter
This tool prompts the user with two methods:
> 1.Single File Mode: Input details manually one file at a time -- Slow but user friendly.
> 2.CSV Feed Mode: Provide a CSV formated file to process in batch -- Fast but technical.

**Method one** is intended for users to familiarize with the program, for each audio file proccessed it will ask the following:
- The name of the game: Users are expected to provide the name with proper casing and following Yume Wiki's namespace conventions. E.g. instead of ".flow" you should input "Dotflow".
- The name of the file: The name of the audio file which can be the three types supported by RPG Maker (.wav, .mp3 and .mid). A relative or absolute path is necessary whenever the file is not within the tool's folder.
- The speed of the song: The speed in which the song plays in-game, represented as a percentage value minus the percentage symbol. I.e. instead of "80%" you should input "80". Speed is capped at a range of 50% to 150%.

Some checks are put in place in case of bad inputs so generally you shouldn't run into issues. Once all the info is accounted for, the program will begin processing the files.
After it is done it will ask you if you wish to process another file, restarting method's one process if you respond "yes". Responding "no" will exit the program.
An "Output" folder in the program's directory will be generated with all the modified audio files.

**Method two** is essentially the same thing but rather than prompting you for every single file, you tell the program to get this information from a CSV file.
When method two is active two things will be asked from you:
- The CSV file: Similar to method one's name of file, if the CSV file is not present within the program's folder a absolute or relative path is necessary.
- Path to BGMs: The path to where all the audio files listed in the CSV are to be fetched from. If you place all the audio files in the same folder, you can leave this one empty.

Once again some checks are in place when prompting the user however you should make sure to know what you are doing as this process can be more delicate. If the CSV file is not one generated by BGM Data Extractor __make sure to follow the pre-requisites as mentioned__ otherwise the program might traceback.
Once the tool gathered the necessary information it will proceed as method one without any interruptions, this means if there are any issues such as missing audio files or bad speed values these iterations will be skipped entirely. Whenever this happens a "log.txt" file will be generated in the same directory for you to review the issue.
If the tool were to traceback or be interrupted, a failsafe system is in place where it will register to a "progress.txt" file (currently in same directory, future versions will move this to a temp folder) all the necesasry information to resume work from the __last successfully processed file__. Meaning if the tool skipped the last few iterations it will resume before the skipping took place, this gives you a chance to also review any bad data before resuming.
In order to resume you will have to select method two again, future versions of the tool might make it so the user is prompted immediately.

# Downloads
A binary file is provided for Windows users although be warned that Windows Defender and a few Anti-Viruses will trigger a false positive, usually under the `Win32/Wacapew.C!ml` detection. There aren't many options for me to resolve this, I can sign the code with a certificate (which costs money...) or I can [submit for review](https://www.microsoft.com/en-us/wdsi/filesubmission) to Microsoft (which likely has to be done on each update). As such I've decided to cut my losses and accept the binary file will be treated as malware, once the tools reach a state where they are unlikely to be updated frequently, I will submit them to Microsoft.
You can read more about it [here](https://gridinsoft.com/blogs/win32-wacapew-cml-detection-analysis/).
